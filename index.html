<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, user-scalable=no"
  />
  <title>Smart Health Without Signal ‚Äî Single File (Mobile)</title>
  <meta
    name="description"
    content="Offline AI-like health helper with CPR guide, Hyderabad emergency numbers, Medical/Plant/Women guidance, text/voice/camera input ‚Äî all in one HTML file."
  />
  <style>
    /* ======= DESIGN SYSTEM (utility-style, phone-first) ======= */
    :root{
      --bg: 210 20% 98%;
      --fg: 215 25% 18%;
      --card: 0 0% 100%;
      --muted: 210 20% 95%;
      --primary: 200 100% 45%;
      --primary-2: 200 100% 60%;
      --accent: 145 65% 48%;
      --emergency: 0 85% 58%;
      --border: 210 20% 88%;
      --radius: 14px;
      --shadow: 0 8px 24px hsl(215 25% 10% / .08);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:hsl(var(--bg));color:hsl(var(--fg));font:16px/1.45 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
    img,video{max-width:100%}
    .container{max-width:1000px;margin:auto;padding:0 16px}
    .hero{
      position:relative;overflow:hidden;color:#fff;
      background: linear-gradient(135deg,hsl(var(--primary)),hsl(var(--primary-2)));
    }
    .hero .wrap{padding:48px 16px}
    h1{font-size:28px;margin:0 0 8px}
    p.lead{opacity:.95;margin:0 0 12px}
    .btn{
      -webkit-tap-highlight-color: transparent;
      display:inline-flex;align-items:center;justify-content:center;
      gap:8px;padding:12px 18px;border-radius:999px;border:1px solid transparent;
      font-weight:600;cursor:pointer;transition:.2s;user-select:none
    }
    .btn-primary{background:#fff;color:hsl(var(--primary));border-color:#ffffff20}
    .btn-primary:active{transform:scale(.98)}
    .btn-ghost{background:transparent;border-color:#ffffff50;color:#fff}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media(min-width:720px){.grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{
      background:hsl(var(--card));border:1px solid hsl(var(--border));
      border-radius:var(--radius);box-shadow:var(--shadow)
    }
    .section{padding:20px 0}
    .pad{padding:16px}
    .title{font-size:22px;font-weight:800;margin:0 0 4px}
    .muted{color:#5f6b7a}
    .pill{font-size:12px;border-radius:999px;padding:6px 10px;border:1px solid hsl(var(--border));display:inline-flex;gap:6px;align-items:center}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .textarea, .input{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid hsl(var(--border));
      background:hsl(var(--bg));font-family:inherit
    }
    .actions{display:flex;gap:8px;justify-content:center}
    .chip{font-size:12px;padding:6px 10px;border-radius:999px;background:hsl(var(--muted));color:#2b2b2b}
    .list{display:flex;flex-direction:column;gap:10px}
    .tap{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:12px;border:1px solid hsl(var(--border));cursor:pointer}
    .tap:active{transform:scale(.99)}
    .ok{color: #16a34a}
    /* accents */
    .emg{background: linear-gradient(135deg,hsl(var(--emergency)),#ff7a7a);color:#fff}
    .health-med{background: linear-gradient(135deg,hsl(var(--primary)),hsl(var(--primary-2)));color:#fff}
    .health-plant{background: hsl(var(--accent));color:#fff}
    .health-women{background: linear-gradient(135deg,#ff6db0,#ff9acb);color:#fff}
    .icon{
      width:36px;height:36px;display:inline-grid;place-items:center;border-radius:10px;background:#fff1;border:1px solid #fff3
    }
    .hidden{display:none !important}
    /* floating helper */
    .bar{display:flex;gap:8px}
    .small{font-size:13px}
    .center{text-align:center}
    .mb8{margin-bottom:8px}.mb12{margin-bottom:12px}.mb16{margin-bottom:16px}.mb20{margin-bottom:20px}
    .mt8{margin-top:8px}.mt12{margin-top:12px}
    .strong{font-weight:700}
    .k{display:inline-block;padding:3px 8px;border-radius:8px;background:#00000008;border:1px solid hsl(var(--border));font-size:12px}
    .kbd{display:inline-flex;gap:6px;align-items:center}
    .tag{display:inline-flex;gap:6px;align-items:center;border-radius:10px;padding:6px 10px;border:1px solid hsl(var(--border))}
    .call a{color:inherit;text-decoration:none}
    .sticky-footer{position:sticky;bottom:0;background:hsl(var(--card));padding:10px;border-top:1px solid hsl(var(--border));border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}
  </style>
</head>
<body>

  <!-- ======= HERO ======= -->
  <header class="hero">
    <div class="container wrap">
      <h1>Smart Health Without Signal</h1>
      <p class="lead">AI-style, offline guidance for emergencies & everyday health. Works on your phone.</p>
      <div class="bar mt8">
        <button id="startBtn" class="btn btn-primary">Start Health Assessment ‚§µ</button>
        <button id="toEmergency" class="btn btn-ghost">Emergency</button>
      </div>
      <div class="row mt8 small">
        <span class="pill">100% Offline</span>
        <span class="pill">Voice ‚Üí Text</span>
        <span class="pill">Camera Detect</span>
        <span class="pill">Expert JSON DB</span>
      </div>
    </div>
  </header>

  <main class="container">

    <!-- ======= EMERGENCY RESPONSE (only CPR + Contacts) ======= -->
    <section id="emergency" class="section">
      <div class="card pad emg">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <div class="title">Emergency Response</div>
            <div class="small" style="opacity:.9">Quick, offline assistance</div>
          </div>
        </div>

        <div class="grid grid-2 mt12">
          <div class="tap" onclick="showCPR()">
            <div class="icon">‚ù§Ô∏è</div>
            <div>
              <div class="strong">CPR Instructions</div>
              <div class="small" style="opacity:.9">Life-saving steps, short & clear</div>
            </div>
          </div>

          <div class="tap" onclick="showContacts()">
            <div class="icon">üìû</div>
            <div>
              <div class="strong">Emergency Contacts (Hyd/TG)</div>
              <div class="small" style="opacity:.9">Tap to call: 100, 108, 112, more‚Ä¶</div>
            </div>
          </div>
        </div>

        <div id="emgDisplay" class="hidden mt12"></div>
    </section>

    <!-- ======= HEALTH CATEGORIES ======= -->
    <section id="health-categories" class="section">
      <div class="grid grid-2">
        <button class="card pad health-med" onclick="selectCategory('medical')">
          <div class="strong mb8">Medical Health</div>
          <div class="small">General symptoms ‚Üí guidance</div>
        </button>
        <button class="card pad health-plant" onclick="selectCategory('plant')">
          <div class="strong mb8">Plant Health</div>
          <div class="small">Common diseases & care</div>
        </button>
        <button class="card pad health-women" onclick="selectCategory('women')">
          <div class="strong mb8">Women‚Äôs Health</div>
          <div class="small">PCOD/PCOS, menstrual care, wellness</div>
        </button>
        <button class="card pad" onclick="clearCategory()">
          <div class="strong mb8">Clear Selection</div>
          <div class="small">Show all results</div>
        </button>
      </div>
      <div id="catHint" class="center small mt12 muted">Tip: pick a category for focused advice.</div>
    </section>

    <!-- ======= INPUT (Text / Voice / Camera) ======= -->
    <section class="section">
      <div class="card">
        <div class="pad">
          <div class="row" style="justify-content:center">
            <button id="modeText" class="btn" onclick="setMode('text')">Text</button>
            <button id="modeVoice" class="btn" onclick="setMode('voice')">Voice</button>
            <button id="modeImage" class="btn" onclick="setMode('image')">Camera</button>
          </div>

          <!-- TEXT -->
          <div id="textBox" class="mt12">
            <textarea id="inputText" class="textarea" rows="4" placeholder="Describe symptoms or question‚Ä¶ (e.g., ‚Äòfever and cough 3 days‚Äô or ‚Äòtomato leaves with brown spots‚Äô)"></textarea>
          </div>

          <!-- VOICE -->
          <div id="voiceBox" class="hidden mt12 center">
            <div class="small muted mb8">Tap mic, speak, then tap again to stop.</div>
            <div class="row" style="justify-content:center">
              <button id="micBtn" class="btn btn-primary">üé§ Start</button>
              <span id="recState" class="pill">Idle</span>
            </div>
            <textarea id="voiceOut" class="textarea mt12" rows="3" placeholder="Transcribed voice will appear here‚Ä¶"></textarea>
          </div>

          <!-- IMAGE -->
          <div id="imageBox" class="hidden mt12">
            <input id="camera" class="input" type="file" accept="image/*" capture="environment" />
            <canvas id="preview" class="mt12" style="width:100%;border-radius:12px"></canvas>
            <div class="small muted mt8">We‚Äôll try to detect if this looks like a plant leaf and suggest checks.</div>
          </div>
        </div>

        <div class="sticky-footer">
          <button id="submitBtn" class="btn btn-primary" style="width:100%">Get AI Advice</button>
        </div>
      </div>
    </section>

    <!-- ======= OUTPUT ======= -->
    <section class="section">
      <div id="output" class="card pad">
        <div class="center muted">Ready to help. Enter text, use voice, or take a photo.</div>
      </div>
    </section>

  </main>

  <script>
    /* ============================================================
       OFFLINE JSON "DATABASE" (small samples; extend as you like)
       ============================================================ */
    const DB = {
      emergency: {
        cprSteps: [
          "Ensure scene is safe. Check responsiveness (tap & shout).",
          "Call 112 (or ask someone). If available, get an AED.",
          "Open airway (head tilt, chin lift). Check normal breathing (‚â§10 sec).",
          "If not breathing or only gasping: Start compressions.",
          "Chest compressions: center of chest, at least 5 cm deep, 100‚Äì120/min. Let chest recoil.",
          "Ratio: 30 compressions, then 2 rescue breaths (if trained & willing).",
          "Continue cycles of 30:2. If AED arrives, turn on and follow prompts.",
          "Do not stop until the person breathes, an AED says stop, or help takes over."
        ],
        contactsHYD: [
          {label:"Single Emergency (India)", number:"112"},
          {label:"Police (India legacy)", number:"100"},
          {label:"Ambulance (Telangana)", number:"108"},
          {label:"Fire", number:"101"},
          {label:"Women Helpline", number:"1091"},
          {label:"Women Helpline (181)", number:"181"},
          {label:"Childline", number:"1098"}
        ]
      },

      medical: [
        {
          name:"Fever & Cough",
          keys:["fever","temperature","cough","cold","flu","sore throat","throat pain"],
          guide:[
            "Hydrate well; rest. Consider paracetamol for fever as directed.",
            "Watch red flags: trouble breathing, chest pain, confusion, bluish lips.",
            "If fever >3 days or very high (>102¬∞F/39¬∞C), seek medical care.",
            "Isolate if flu-like; mask to protect others."
          ]
        },
        {
          name:"Diarrhoea / Vomiting",
          keys:["diarrhea","diarrhoea","loose motion","vomit","food poisoning","stomach bug"],
          guide:[
            "Oral rehydration solution (ORS) small sips frequently.",
            "Avoid oily/spicy foods; stick to bland diet (rice/bananas/curd).",
            "Seek care if blood in stool, high fever, severe dehydration, or in infants/elderly."
          ]
        },
        {
          name:"Headache",
          keys:["headache","migraine","head pain"],
          guide:[
            "Hydration, dark/quiet room, consider paracetamol/ibuprofen if suitable.",
            "Red flags: worst headache ever, head injury, fever + neck stiffness, weakness/vision changes ‚Üí urgent care."
          ]
        }
      ],

      plant: [
        {
          name:"Tomato ‚Äî Early Blight",
          keys:["tomato","brown spots","leaf spots","target spots","tomato leaves"],
          guide:[
            "Remove affected leaves; avoid overhead watering.",
            "Mulch soil; rotate crops; use disease-resistant varieties.",
            "If severe, consider appropriate fungicide as per local guidelines."
          ]
        },
        {
          name:"Powdery Mildew (General)",
          keys:["white powder","powdery","mildew","leaves white"],
          guide:[
            "Improve airflow; avoid wetting leaves.",
            "Remove heavily infected parts; keep plants well-spaced.",
            "Bicarbonate or labeled fungicides may help (follow instructions)."
          ]
        },
        {
          name:"Root Rot (Overwatering)",
          keys:["yellowing","wilting","soggy soil","root rot"],
          guide:[
            "Reduce watering; ensure drainage.",
            "Repot with fresh medium if pot plant; trim rotted roots.",
            "Prevent by watering only when topsoil is dry."
          ]
        }
      ],

      women: [
        {
          name:"PCOD / PCOS ‚Äî Basics",
          keys:["pcod","pcos","irregular periods","ovarian cysts","facial hair","acne"],
          guide:[
            "Lifestyle: balanced diet, regular exercise, weight management.",
            "Cycle tracking; discuss with clinician about metformin or OCPs if advised.",
            "Watch mental health; seek guidance for fertility planning when needed."
          ]
        },
        {
          name:"Menstrual Care",
          keys:["period pain","cramps","dysmenorrhea","menstrual","PMS"],
          guide:[
            "Heat pad, gentle stretching; hydration.",
            "NSAIDs like ibuprofen at onset (if safe for you).",
            "Seek care if bleeding very heavy (soaking >1 pad/hour), cycles <21 or >90 days, or severe pain."
          ]
        },
        {
          name:"Common Women‚Äôs Wellness",
          keys:["vaginal discharge","UTI","burning urine","breast self exam","wellness"],
          guide:[
            "Unusual discharge/odor/itching ‚Üí consider medical check; maintain hygiene, breathable underwear.",
            "UTI signs: burning, urgency, lower abdominal pain ‚Üí hydrate; consider medical review & urine test.",
            "Monthly breast self-exam; schedule routine screening per age group."
          ]
        }
      ]
    };

    /* ============================================================
       STATE
       ============================================================ */
    let currentCategory = null;     // 'medical' | 'plant' | 'women' | null
    let mode = 'text';              // 'text' | 'voice' | 'image'
    let recognizing = false;        // speech state
    let recognition;                // SpeechRecognition instance

    /* ============================================================
       HELPERS & UI
       ============================================================ */
    const $ = sel => document.querySelector(sel);
    const out = $('#output');
    const emgDisplay = $('#emgDisplay');

    function scrollToCategories(){
      document.getElementById('health-categories').scrollIntoView({behavior:'smooth', block:'start'});
    }
    function scrollToEmergency(){
      document.getElementById('emergency').scrollIntoView({behavior:'smooth', block:'start'});
    }

    // Start buttons
    $('#startBtn').addEventListener('click', scrollToCategories);
    $('#toEmergency').addEventListener('click', scrollToEmergency);

    // Category selection
    function selectCategory(cat){
      currentCategory = cat;
      $('#catHint').textContent = `Selected: ${cat.toUpperCase()}. Your searches will focus on this.`;
      flashResult(renderCategoryIntro(cat));
    }
    function clearCategory(){
      currentCategory = null;
      $('#catHint').textContent = 'Tip: pick a category for focused advice.';
      flashResult(`<div class="center muted">Category cleared. Enter a query or choose a category.</div>`);
    }

    function renderCategoryIntro(cat){
      if(cat==='medical'){
        return cardBlock("How general check should be",[
          "Check temperature, pulse, breathing, level of alertness.",
          "Note duration & severity of symptoms; list medicines taken.",
          "Look for red flags: breathing difficulty, chest pain, confusion, seizures, severe dehydration."
        ]) + listByDB(DB.medical, "If you have these symptoms, guidance:");
      }
      if(cat==='plant'){
        return listByDB(DB.plant, "Common plant diseases & care:");
      }
      if(cat==='women'){
        return listByDB(DB.women, "Women‚Äôs health topics (PCOD/PCOS, menstrual care, wellness):");
      }
      return '';
    }

    function listByDB(arr, heading){
      return `
        <div class="mb12 strong">${heading}</div>
        <div class="list">
          ${arr.map(item=>`
            <div class="tap" onclick='showTopic(${JSON.stringify(item.name)})'>
              <div class="icon">‚ÑπÔ∏è</div>
              <div>
                <div class="strong">${item.name}</div>
                <div class="small muted">${item.guide[0]}</div>
              </div>
            </div>
          `).join('')}
        </div>`;
    }

    function showTopic(name){
      const pools=[...DB.medical,...DB.plant,...DB.women];
      const item=pools.find(x=>x.name===name);
      if(!item){return}
      flashResult(cardBlock(item.name,item.guide));
    }

    function cardBlock(title, points){
      return `
        <div class="card pad">
          <div class="title mb8">${title}</div>
          <ul class="small">
            ${points.map(p=>`<li class="mb8">‚Ä¢ ${p}</li>`).join('')}
          </ul>
        </div>`;
    }

    function flashResult(html){
      out.innerHTML = html;
    }

    /* ============================================================
       EMERGENCY: CPR & CONTACTS
       ============================================================ */
    function showCPR(){
  emgDisplay.classList.remove('hidden');
  emgDisplay.innerHTML = `
    <div class="card pad" style="background:#fff;border-color:hsl(var(--border))">
      ${cardBlock("CPR ‚Äî Step by Step", DB.emergency.cprSteps)}
    </div>`;
}

function showContacts(){
  emgDisplay.classList.remove('hidden');
  const rows = DB.emergency.contactsHYD.map(c=>{
    return `<div class="tap call" style="background:hsl(var(--muted));border-color:hsl(var(--border))">
      <div class="icon" style="background:white;border-color:hsl(var(--border))">üìû</div>
      <div>
        <div class="strong">${c.label}</div>
        <div class="row small">
          <a href="tel:${c.number}" class="tag">Call ${c.number}</a>
          <span class="muted">Hyderabad/Telangana</span>
        </div>
      </div>
    </div>`;
  }).join('');
  emgDisplay.innerHTML = `
    <div class="card pad" style="background:#fff;border-color:hsl(var(--border))">
      <div class="title mb8">Emergency Contacts</div>
      ${rows}
    </div>`;
}

    /* ============================================================
       INPUT MODES
       ============================================================ */
    function setMode(m){
      mode=m;
      // toggle active button styles
      ['modeText','modeVoice','modeImage'].forEach(id => $('#'+id).classList.remove('btn-primary'));
      if(m==='text') $('#modeText').classList.add('btn-primary');
      if(m==='voice') $('#modeVoice').classList.add('btn-primary');
      if(m==='image') $('#modeImage').classList.add('btn-primary');
      // show/hide boxes
      $('#textBox').classList.toggle('hidden', m!=='text');
      $('#voiceBox').classList.toggle('hidden', m!=='voice');
      $('#imageBox').classList.toggle('hidden', m!=='image');
    }
    setMode('text');

    /* ---------- Voice (Web Speech API) ---------- */
    (function initVoice(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      const mic = $('#micBtn');
      const state = $('#recState');
      if(!SR){
        mic.disabled = true;
        state.textContent = 'Voice not supported on this browser';
        return;
      }
      recognition = new SR();
      recognition.lang = 'en-IN';
      recognition.interimResults = true;
      recognition.continuous = false;

      mic.addEventListener('click', ()=>{
        if(!recognizing){
          recognition.start();
          recognizing = true;
          mic.textContent = '‚èπ Stop';
          state.textContent = 'Listening‚Ä¶';
        }else{
          recognition.stop();
        }
      });

      recognition.onresult = (e)=>{
        let finalText = '';
        for(let i=0;i<e.results.length;i++){
          const chunk = e.results[i][0].transcript;
          if(e.results[i].isFinal) finalText += chunk + ' ';
        }
        if(finalText.trim()){
          $('#voiceOut').value = ( $('#voiceOut').value + ' ' + finalText ).trim();
        }
      };
      recognition.onend = ()=>{
        recognizing = false;
        mic.textContent = 'üé§ Start';
        state.textContent = 'Idle';
      };
      recognition.onerror = ()=>{
        recognizing = false;
        mic.textContent = 'üé§ Start';
        state.textContent = 'Error / Retry';
      };
    })();

    /* ---------- Image (camera capture + simple green detector) ---------- */
    const fileInput = $('#camera');
    const canvas = $('#preview');
    const ctx = canvas.getContext('2d');

    fileInput.addEventListener('change', async (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const img = new Image();
      img.onload = ()=>{
        const w = canvas.clientWidth || 320;
        const scale = w / img.width;
        const h = img.height * scale;
        canvas.width = w; canvas.height = h;
        ctx.drawImage(img,0,0,w,h);
        // crude plant-leaf heuristic: % of greenish pixels
        const data = ctx.getImageData(0,0,w,h).data;
        let greenish=0;
        for(let i=0;i<data.length;i+=4){
          const r=data[i], g=data[i+1], b=data[i+2];
          if(g>90 && g>r+10 && g>b+10) greenish++;
        }
        const ratio = greenish / (data.length/4);
        let guess = ratio>0.25 ? "This looks like a leaf/plant surface. Try searching for 'leaf spots', 'powdery mildew', or crop name." :
                  "Could not confidently detect plant leaf. You can still describe what you see in text.";
        flashResult(cardBlock("Image Analysis (Offline heuristic)",[
          `Greenish pixel ratio: ${(ratio*100).toFixed(1)}%`,
          guess,
          "Tip: enter crop name + symptom (e.g., ‚Äútomato brown spots‚Äù) and tap Get AI Advice."
        ]));
      };
      img.src = URL.createObjectURL(file);
    });

    /* ============================================================
       SEARCH ENGINE (very lightweight keyword matcher)
       ============================================================ */
    function normalize(t){ return (t||'').toLowerCase(); }
    function searchAll(query){
      const q = normalize(query);
      const buckets = [];
      function matchBlock(arr,label){
        const hits = arr
          .map(item=>{
            const hit = item.keys.some(k=> q.includes(k.toLowerCase()));
            const nameHit = q.includes(item.name.toLowerCase());
            return (hit || nameHit) ? item : null;
          })
          .filter(Boolean);
        if(hits.length){ buckets.push({label, hits}); }
      }
      // prioritize currentCategory if set
      const order = currentCategory
        ? [currentCategory, ...['medical','plant','women'].filter(x=>x!==currentCategory)]
        : ['medical','plant','women'];

      order.forEach(cat=>{
        if(cat==='medical') matchBlock(DB.medical,'Medical matches');
        if(cat==='plant')   matchBlock(DB.plant,'Plant matches');
        if(cat==='women')   matchBlock(DB.women,'Women‚Äôs health matches');
      });

      return buckets;
    }

    function renderResults(buckets, raw){
      if(!buckets.length){
        flashResult(cardBlock("No direct match",[
          "Try simpler words (e.g., 'fever cough', 'tomato leaf spots', 'period cramps').",
          currentCategory ? `Currently focused on: ${currentCategory.toUpperCase()}` : "Tip: choose a category for better results."
        ]) + `<div class="card pad mt12 small"><span class="muted">You searched:</span> ${escapeHTML(raw)}</div>`);
        return;
      }
      let html = '';
      buckets.forEach(b=>{
        html += `<div class="card pad mb12"><div class="strong mb8">${b.label}</div>`;
        b.hits.forEach(item=>{
          html += `<div class="tap" onclick='showTopic(${JSON.stringify(item.name)})'>
            <div class="icon">‚úÖ</div>
            <div>
              <div class="strong">${item.name}</div>
              <div class="small muted">${item.guide[0]}</div>
            </div>
          </div>`;
        });
        html += `</div>`;
      });
      html += `<div class="small muted">Query: ${escapeHTML(raw)}</div>`;
      flashResult(html);
    }

    function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

    /* ============================================================
       GET AI ADVICE (text/voice/image ‚Üí text search)
       ============================================================ */
    function gatherQuery(){
      if(mode==='text'){
        return $('#inputText').value.trim();
      }else if(mode==='voice'){
        return $('#voiceOut').value.trim();
      }else if(mode==='image'){
        // Encourage user to add a few words after taking photo
        return prompt("Add a few words about the image (e.g., plant type + symptom). This helps offline search:", "")?.trim() || "";
      }
    }

    $('#submitBtn').addEventListener('click', ()=>{
      const q = gatherQuery();
      if(!q){
        flashResult(`<div class="center muted">Enter or dictate a question/symptoms first.</div>`);
        return;
      }
      flashResult(`<div class="center">Analyzing‚Ä¶</div>`);
      // simulate small delay
      setTimeout(()=>{
        const results = searchAll(q);
        renderResults(results, q);
      }, 200);
    });

    /* ============================================================
       INIT CPR/CONTACTS PREVIEW
       ============================================================ */
    showCPR();

    /* ============================================================
       ACCESSIBILITY & SMALL UX NITS
       ============================================================ */
    // Press Enter (without Shift) in textarea to submit
    $('#inputText').addEventListener('keypress', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){
        e.preventDefault();
        $('#submitBtn').click();
      }
    });

  </script>
</body>
</html>